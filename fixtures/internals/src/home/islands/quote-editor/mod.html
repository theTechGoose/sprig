<div>
  <form (submit)="handleSubmit($event)" class="space-y-10 max-w-4xl">
    <!-- Header -->
    <div class="glass-card p-6 space-y-5">
      <div class="grid sm:grid-cols-3 gap-5">
        <div class="sm:col-span-2">
          <label class="block text-sm font-medium text-stone-400 mb-2">
            Summary
          </label>
          <input
            type="text"
            required
            [value]="summary"
            (input)="onSummaryInput($event)"
            class="w-full px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm"
            placeholder="Brief description of the work"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-stone-400 mb-2">
            Status
          </label>
          <select
            [value]="status"
            (change)="onStatusChange($event)"
            class="w-full px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 input-field text-sm"
          >
            <option value="draft">Draft</option>
            <option value="sent">Sent</option>
            <option value="accepted">Accepted</option>
            <option value="rejected">Rejected</option>
          </select>
        </div>
      </div>

      <div>
        <label class="block text-sm font-medium text-stone-400 mb-2">
          Customer
        </label>
        <select
          [value]="customerId"
          (change)="onCustomerChange($event)"
          class="w-full px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 input-field text-sm max-w-sm"
        >
          <option *for="c of customers" [value]="c.id">{{ c.name }}</option>
        </select>
      </div>
    </div>

    <!-- Assumptions -->
    <div class="glass-card p-6">
      <label class="block text-sm font-medium text-stone-400 mb-3">
        Assumptions
      </label>
      <div *if="assumptions.length > 0" class="flex flex-wrap gap-2 mb-4">
        <span
          *for="a of assumptions; let i = index"
          class="inline-flex items-center gap-1.5 text-sm text-stone-300 bg-stone-800/80 border border-stone-700/40 rounded-full px-3.5 py-1.5"
        >
          {{ a }}
          <button
            type="button"
            (click)="removeAssumption(i)"
            class="text-stone-500 hover:text-red-400 ml-0.5"
          >
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </span>
      </div>
      <div class="flex gap-2">
        <input
          type="text"
          [value]="newAssumption"
          (input)="onNewAssumptionInput($event)"
          (keydown)="onNewAssumptionKeydown($event)"
          class="flex-1 px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm"
          placeholder="Add assumption..."
        />
        <button
          type="button"
          (click)="addAssumption()"
          class="px-4 py-2.5 text-sm font-medium text-amber-500 hover:text-amber-400 bg-stone-800 hover:bg-stone-700 border border-stone-700/50 rounded-lg"
        >
          Add
        </button>
      </div>
    </div>

    <!-- Exclusions -->
    <div class="glass-card p-6">
      <label class="block text-sm font-medium text-stone-400 mb-3">
        Exclusions
      </label>
      <div *if="exclusions.length > 0" class="flex flex-wrap gap-2 mb-4">
        <span
          *for="ex of exclusions; let i = index"
          class="inline-flex items-center gap-1.5 text-sm text-stone-300 bg-stone-800/80 border border-stone-700/40 rounded-full px-3.5 py-1.5"
        >
          {{ ex }}
          <button
            type="button"
            (click)="removeExclusion(i)"
            class="text-stone-500 hover:text-red-400 ml-0.5"
          >
            <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </span>
      </div>
      <div class="flex gap-2">
        <input
          type="text"
          [value]="newExclusion"
          (input)="onNewExclusionInput($event)"
          (keydown)="onNewExclusionKeydown($event)"
          class="flex-1 px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm"
          placeholder="Add exclusion..."
        />
        <button
          type="button"
          (click)="addExclusion()"
          class="px-4 py-2.5 text-sm font-medium text-amber-500 hover:text-amber-400 bg-stone-800 hover:bg-stone-700 border border-stone-700/50 rounded-lg"
        >
          Add
        </button>
      </div>
    </div>

    <!-- Estimate Tabs -->
    <div class="glass-card p-6">
      <div class="inline-flex bg-stone-800/60 rounded-lg p-1 mb-6">
        <button
          type="button"
          (click)="setActiveTab('low')"
          [class]="getTabClass('low')"
        >
          Low <span [class]="getTabTotalClass('low')">{{ formatEstimateTotal('low') }}</span>
        </button>
        <button
          type="button"
          (click)="setActiveTab('fair')"
          [class]="getTabClass('fair')"
        >
          Fair <span [class]="getTabTotalClass('fair')">{{ formatEstimateTotal('fair') }}</span>
        </button>
        <button
          type="button"
          (click)="setActiveTab('high')"
          [class]="getTabClass('high')"
        >
          High <span [class]="getTabTotalClass('high')">{{ formatEstimateTotal('high') }}</span>
        </button>
      </div>

      <!-- Low Estimate -->
      <div *if="isActiveTab('low')">
        <div class="mb-5">
          <label class="block text-sm font-medium text-stone-400 mb-2">Timeline</label>
          <input
            type="text"
            [value]="lowEstimate.timeline"
            (input)="onTimelineInput('low', $event)"
            class="px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm max-w-xs"
            placeholder="e.g. 4-5 weeks"
          />
        </div>
        <LineItemEditor
          [items]="lowEstimate.lineItems"
          [onChange]="updateLineItems.bind(this, 'low')"
        />
      </div>

      <!-- Fair Estimate -->
      <div *if="isActiveTab('fair')">
        <div class="mb-5">
          <label class="block text-sm font-medium text-stone-400 mb-2">Timeline</label>
          <input
            type="text"
            [value]="fairEstimate.timeline"
            (input)="onTimelineInput('fair', $event)"
            class="px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm max-w-xs"
            placeholder="e.g. 4-5 weeks"
          />
        </div>
        <LineItemEditor
          [items]="fairEstimate.lineItems"
          [onChange]="updateLineItems.bind(this, 'fair')"
        />
      </div>

      <!-- High Estimate -->
      <div *if="isActiveTab('high')">
        <div class="mb-5">
          <label class="block text-sm font-medium text-stone-400 mb-2">Timeline</label>
          <input
            type="text"
            [value]="highEstimate.timeline"
            (input)="onTimelineInput('high', $event)"
            class="px-4 py-3 bg-stone-900/80 border border-stone-700/50 rounded-xl text-stone-200 placeholder-stone-500 input-field text-sm max-w-xs"
            placeholder="e.g. 4-5 weeks"
          />
        </div>
        <LineItemEditor
          [items]="highEstimate.lineItems"
          [onChange]="updateLineItems.bind(this, 'high')"
        />
      </div>
    </div>

    <div class="flex items-center gap-4 pt-6 border-t border-stone-800/50">
      <button
        type="submit"
        [disabled]="saving"
        class="px-6 py-2.5 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 disabled:opacity-50 text-white text-sm font-semibold rounded-xl transition-all duration-300 shadow-lg shadow-amber-900/20 hover:shadow-amber-900/30 hover:-translate-y-0.5"
      >
        {{ submitText }}
      </button>
      <a
        [href]="prefix + '/quotes'"
        class="px-5 py-2.5 text-sm font-medium text-stone-400 hover:text-stone-200 bg-stone-800/80 hover:bg-stone-700 rounded-xl border border-stone-700/50 transition-all duration-200"
      >
        Cancel
      </a>
      <button
        *if="isEdit"
        type="button"
        (click)="showDeleteConfirm()"
        class="ml-auto px-5 py-2.5 text-sm font-medium text-red-400 hover:text-red-300 hover:bg-red-900/30 rounded-xl border border-transparent hover:border-red-900/50 transition-all duration-200"
      >
        Delete
      </button>
    </div>
  </form>

  <ConfirmDialog
    [open]="confirmDelete"
    title="Delete Quote"
    message="Are you sure you want to delete this quote? This action cannot be undone."
    [onConfirm]="handleDelete.bind(this)"
    [onCancel]="hideDeleteConfirm.bind(this)"
  />
</div>
