<div #containerRef class="flex justify-center">
  <div
    class="relative rounded-[2.5rem] border-2 border-stone-700/80 bg-stone-950 shadow-2xl shadow-black/50"
    style="width: 300px; height: 580px"
  >
    <!-- Notch -->
    <div class="absolute top-0 left-1/2 -translate-x-1/2 w-28 h-6 bg-stone-950 rounded-b-2xl z-10"></div>

    <!-- Status bar -->
    <div class="absolute top-1 left-0 right-0 flex justify-between items-center px-8 py-1 z-10">
      <span class="text-[10px] text-stone-500 font-medium">9:41</span>
      <div class="flex items-center gap-1">
        <div class="w-4 h-2 border border-stone-600 rounded-sm">
          <div class="w-2.5 h-full bg-stone-500 rounded-sm"></div>
        </div>
      </div>
    </div>

    <!-- Screen -->
    <div class="absolute inset-2 top-8 bottom-2 rounded-[2rem] overflow-hidden bg-stone-900 flex flex-col">
      <!-- Chat header -->
      <div class="flex items-center gap-3 px-4 py-3 border-b border-stone-800/80 flex-shrink-0">
        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-amber-500 to-amber-700 flex items-center justify-center">
          <span class="text-[10px] font-bold text-white">PM</span>
        </div>
        <div>
          <p class="text-xs font-semibold text-stone-100 leading-none">Paperwork Monsters</p>
          <p class="text-[10px] text-stone-500 mt-0.5">Online</p>
        </div>
      </div>

      <!-- Messages -->
      <div
        #chatRef
        class="flex-1 overflow-hidden px-3 py-3 space-y-2"
        [style.opacity]="clearing ? 0 : 1"
        style="transition: opacity 0.4s ease-out"
      >
        <div *for="let msg of visibleMsgs" class="flex msg-in" [class.justify-end]="msg.from === 'user'" [class.justify-start]="msg.from === 'bot'">
          <div
            class="max-w-[85%] px-3 py-2 text-[11px] leading-relaxed"
            [class.bg-amber-600]="msg.from === 'user'"
            [class.text-white]="msg.from === 'user'"
            [class.rounded-2xl]="true"
            [class.rounded-br-md]="msg.from === 'user'"
            [class.bg-stone-800]="msg.from === 'bot'"
            [class.text-stone-200]="msg.from === 'bot'"
            [class.rounded-bl-md]="msg.from === 'bot'"
          >
            {{ msg.text }}
            <div *if="msg.lines" class="mt-1.5 font-mono text-[10px] leading-[1.6] whitespace-pre-wrap opacity-90">
              <div *for="let line of msg.lines">{{ line || '\u00A0' }}</div>
            </div>
          </div>
        </div>

        <!-- Typing indicator -->
        <div *if="showTyping" class="flex justify-start msg-in">
          <div class="bg-stone-800 px-4 py-2.5 rounded-2xl rounded-bl-md flex items-center gap-1">
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-stone-500" style="animation-delay: 0ms"></span>
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-stone-500" style="animation-delay: 150ms"></span>
            <span class="typing-dot w-1.5 h-1.5 rounded-full bg-stone-500" style="animation-delay: 300ms"></span>
          </div>
        </div>
      </div>

      <!-- Input bar -->
      <div class="px-3 py-2 border-t border-stone-800/80 flex-shrink-0">
        <div class="flex items-center gap-2 bg-stone-800/60 rounded-full px-3 py-1.5">
          <span class="text-[10px] text-stone-600 flex-1">Message</span>
          <svg class="w-4 h-4 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
          </svg>
        </div>
      </div>
    </div>
  </div>
</div>
